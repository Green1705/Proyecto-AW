<%- include('../partials/head', { title: 'Gestión de Concesionarios' }) %>
<%- include('../partials/navbar') %>

<main class="container py-5">
	<section class="dealership-section">
		<header class="mb-4">
			<h1 class="h3 mb-1">Gestión de concesionarios</h1>
			<p class="text-muted mb-3">
				Consulta todos los concesionarios y utiliza las acciones para agregar, actualizar o eliminar registros.
			</p>
			<% if (success && success.length) { %>
				<div class="alert alert-success py-2 mb-2"><%= success[0] %></div>
			<% } %>
			<% if (error && error.length) { %>
				<div class="alert alert-danger py-2 mb-2"><%= error[0] %></div>
			<% } %>
		</header>

		<div class="table-responsive">
			<table class="table table-hover align-middle">
				<thead class="table-light">
					<tr>
						<th scope="col">Nombre</th>
						<th scope="col" class="text-end">ID</th>
					</tr>
				</thead>
				<tbody>
					<% if (Array.isArray(dealerships) && dealerships.length) { %>
						<% dealerships.forEach((dealer) => { %>
							<tr class="dealership-row" data-dealer-id="<%= dealer.id_concesionario %>">
								<td>
									<strong><%= dealer.nombre %></strong>
									<span class="d-block text-muted small">Teléfono: <%= dealer.telefono %></span>
								</td>
								<td class="text-end fw-semibold">#<%= dealer.id_concesionario %></td>
							</tr>
							<tr class="dealership-details" id="dealership-details-<%= dealer.id_concesionario %>">
								<td colspan="2">
									<div class="dealership-details-card">
										<div class="row g-4">
											<div class="col-md-8">
												<ul class="dealership-info">
													<li><strong>Nombre:</strong> <%= dealer.nombre %></li>
													<li><strong>Teléfono:</strong> <%= dealer.telefono %></li>
													<li><strong>ID Dirección:</strong> <%= dealer.direccion_id || 'N/D' %></li>
												</ul>
											</div>
											<div class="col-md-4">
												<div class="dealership-actions">
													<button type="button" class="btn btn-success w-100" data-action="add">
														Agregar concesionario
													</button>
													<button type="button" class="btn btn-outline-primary w-100" data-action="edit" data-dealer-id="<%= dealer.id_concesionario %>">
														Modificar este concesionario
													</button>
													<button type="button" class="btn btn-outline-danger w-100" data-action="delete" data-dealer-id="<%= dealer.id_concesionario %>">
														Eliminar este concesionario
													</button>
												</div>
											</div>
										</div>
									</div>
								</td>
							</tr>
						<% }) %>
					<% } else { %>
						<tr>
							<td colspan="2" class="text-center text-muted py-5">
								No hay concesionarios registrados actualmente.
							</td>
						</tr>
					<% } %>
				</tbody>
			</table>
		</div>
	</section>
</main>

<style>
	.dealership-row {
		cursor: pointer;
	}

	.dealership-row:hover {
		background-color: #eef2ff;
	}

	.dealership-details {
		display: none;
	}

	.dealership-details.show {
		display: table-row;
	}

	.dealership-details-card {
		padding: 1.5rem;
		border: 1px solid #e2e8f0;
		border-radius: 0.75rem;
		background-color: #ffffff;
	}

	.dealership-info {
		list-style: none;
		padding-left: 0;
		margin-bottom: 0;
	}

	.dealership-info li {
		margin-bottom: 0.4rem;
		color: #475569;
	}

	.dealership-actions {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}
</style>

<script>
	(function setupDealershipRows() {
		const rows = document.querySelectorAll(".dealership-row");
		rows.forEach((row) => {
			row.addEventListener("click", () => {
				const dealerId = row.getAttribute("data-dealer-id");
				const detailRow = document.getElementById(`dealership-details-${dealerId}`);
				if (!detailRow) return;
				const isVisible = detailRow.classList.contains("show");
				document.querySelectorAll(".dealership-details.show").forEach((openRow) => {
					openRow.classList.remove("show");
				});
				if (!isVisible) detailRow.classList.add("show");
			});
		});
	})();
</script>

<%- include('partials/footer') %>
